---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(ambrosia)
library(dplyr)
library(ggplot2)
library(knitr)
```


```{r}
c(1.28,1.14,-0.19,0.21,-0.33,0.5,0.1,16,5.06,100,20)->original_param_vector
parameter_names<-c('A_s', 'A_n', 'xi_ss', 'xi_cross', 'xi_nn', 'nu1_n',
                     'lambda_s', 'k_s', 'Pm', 'psscl','pnscl')
parameter_data<-data.frame(parameter_names,original_param_vector)
tmp_param<-vec2param(original_param_vector)

kable(parameter_data ,col.names = c("parameter_name","value"),format = "pandoc")

```


```{r}


Test_Data<-data.frame(Y=seq(0.1,30, by=0.1))
#Add sample values of Ps and Pn. These are in accordance with Robert's original samp,e
Test_Data %>% mutate(Ps=0.1,Pn=0.2)->Test_Data




Food_Demand<-food.dmnd(Test_Data$Ps,Test_Data$Pn,Test_Data$Y,params=tmp_param)
```

```{r}

#Make a plot of demand
Food_Demand$Total_Demand<-Food_Demand$Qs+Food_Demand$Qn
Food_Demand$Y<-seq(0.1,30, by=0.1)


g<-ggplot()+
    geom_line(data=Food_Demand,aes(x=Y,y=Qs,color="Staple Demand"))+
    geom_line(data=Food_Demand,aes(x=Y,y=Qn,color="Non Staple Demand"))+
    xlab("GDP per capita in thousand USD" )+
    ylab("Thousand calories")+
    ggtitle("Calculated values of food demand using model parameters")+
    labs(subtitle="Prices are set to 0.1 for Staples and 0.2 for Non-staples. This is the same as fig 1 from Edmonds et al")

g
```

```{r}
#Now let's calculate some model parameters
#Warning: This might take a long time to run since we are using the entire training dataset

Sample_Data <- read.csv("paper1/Latest_Iteration/Training_Data.csv") %>% filter(year %in% c(2000:2010))

temp_data <- create_dataset_for_parameter_fit(data=Sample_Data,min_clusters = 100) 

  
```

```{r}
#Analyze distribution of observational error for non-staples

g<-ggplot()+
   geom_histogram(data=temp_data,aes(x=sig2Qn),bins = 40)+
   xlab("Observational error within clusters for non-staples")+
   ggtitle("Distribution of observational error for non-staples")
g
```


```{r}
#Analyze distribution of observational error for non-staples

g<-ggplot()+
   geom_histogram(data=temp_data,aes(x=sig2Qs),bins = 40)+
   xlab("Observational error within clusters for staples")+
   ggtitle("Distribution of observational error for staples")
g
```
```{r}
new_parameters <- calculate_ambrosia_params(datadir = "outputs/Processed_Data_for_MC.csv")
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
