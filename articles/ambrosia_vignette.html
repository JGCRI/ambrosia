<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`ambrosia`: User Tutorial • ambrosia</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`ambrosia`: User Tutorial">
<meta property="og:description" content="ambrosia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ambrosia</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ambrosia_vignette.html">`ambrosia`: User Tutorial</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ambrosia_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>ambrosia</code>: User Tutorial</h1>
                        <h4 class="author">Kanishka Narayan</h4>
            
            <h4 class="date">2020-10-08</h4>
      
      
      <div class="hidden name"><code>ambrosia_vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ambrosia</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="part-1-calculating-food-demand-exploring-demand-side-variables-for-a-given-set-of-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#part-1-calculating-food-demand-exploring-demand-side-variables-for-a-given-set-of-parameters" class="anchor"></a>Part 1: Calculating food demand, exploring demand side variables for a given set of parameters</h1>
<p>This section explains how a user can set up the parameter structure for the <code>ambrosia</code> and explore the basic demand side variables.</p>
<div id="example-1-1-calculate-food-demand" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-1-calculate-food-demand" class="anchor"></a>Example 1.1: Calculate food demand</h2>
<p>Demand in thousand calories can be calculated for different levels of income (<code>Y</code>) in thousand USD per capita for different prices of staples (<code>Ps</code>) and non-staples (<code>Pn</code>) both in $ per capita per day using the parameters calculated in example 1.1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Get a sample data set</span>
<span class="va">Test_Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">30</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Add sample values of Ps and Pn</span>
<span class="va">Test_Data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Ps<span class="op">=</span><span class="fl">0.1</span>,Pn<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">-&gt;</span><span class="va">Test_Data</span>

<span class="co">#Calculate food demand</span>
<span class="va">Food_Demand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/food.dmnd.html">food.dmnd</a></span><span class="op">(</span><span class="va">Test_Data</span><span class="op">$</span><span class="va">Ps</span>,<span class="va">Test_Data</span><span class="op">$</span><span class="va">Pn</span>,<span class="va">Test_Data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-1-2-visualize-food-demand" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-2-visualize-food-demand" class="anchor"></a>Example 1.2: Visualize food demand</h2>
<p>The demand along with the price and income elasticities calculated using the <code><a href="../reference/food.dmnd.html">food.dmnd()</a></code> function can be visualized easily.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Add income and total demand to the data frame created in example 1.2 and create a plot.  </span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">Total_Demand</span> <span class="op">&lt;-</span> <span class="va">Food_Demand</span><span class="op">$</span><span class="va">Qs</span><span class="op">+</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">Qn</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">30</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>

<span class="co">#Create the plot</span>
<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Y</span>,y<span class="op">=</span> <span class="va">Qs</span>,color<span class="op">=</span> <span class="st">"Staple Demand"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Y</span>,y<span class="op">=</span> <span class="va">Qn</span>,color<span class="op">=</span> <span class="st">"Non Staple Demand"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"GDP per capita in thousand USD"</span> <span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Thousand calories"</span><span class="op">)</span>

<span class="co">#Plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>    </code></pre></div>
<p><img src="example_3.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-1-3-visualize-budget-shares" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-3-visualize-budget-shares" class="anchor"></a>Example 1.3: Visualize budget shares</h2>
<p>Using the function above will create a dataframe with estimates of demand for each level of price and incomes and also the budget shares (shares of incomes spent) for staples and non-staples.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Rename the budget shares columns</span>
<span class="va">budget_shares</span> <span class="op">&lt;-</span> <span class="va">Food_Demand</span> <span class="op">%&gt;%</span> 
                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>share_of_staples<span class="op">=</span> <span class="va">alpha.s</span><span class="op">*</span><span class="fl">100</span>,
                        share_of_non_staples<span class="op">=</span> <span class="va">alpha.n</span><span class="op">*</span><span class="fl">100</span>,
                        share_of_materials<span class="op">=</span> <span class="va">alpha.m</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>

<span class="co">#Add some income or Y values</span>
<span class="va">budget_shares</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">30</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>

<span class="co">#Create the plot</span>
<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">budget_shares</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">share_of_staples</span>,color<span class="op">=</span><span class="st">"Staple share"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">budget_shares</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">share_of_non_staples</span>,color<span class="op">=</span><span class="st">"Non Staple share"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"GDP per capita in thousand USD"</span> <span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Percent of Income"</span><span class="op">)</span>

<span class="co">#Plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></code></pre></div>
<p><img src="example_4.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-1-4-calculate-income-elasticities" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-4-calculate-income-elasticities" class="anchor"></a>Example 1.4: Calculate income elasticities</h2>
<p>The demand code iteratively solves for the budget shares using a Broyden solver with changing incomes and re-calculates income and price elasticities for changes in budget shares.The user can separately analyze the income elasticities by using two functions (one for staples and other for non-staples) from within the parameter structure generated above in example 1.1.</p>
<p>For income elasticities, the functions generated within the parameter structure stored within the object <code>yfunc</code> return the elasticities themselves for a given level of income. Setting the optional parameter within these functions to TRUE would return the income term itself (i.e. <code>Y</code>^ <code>elas</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Note that setting the second argument to "TRUE" in the functions below would return the Y term (Y^elas) as opposed to the elasticity.</span>

<span class="co">#Get the parameter structure</span>

<span class="va">tmp_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vec2param.html">vec2param</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Income elasticity for staples</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.s</span> <span class="op">&lt;-</span> <span class="va">tmp_param</span><span class="op">$</span><span class="va">yfunc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span>Y<span class="op">=</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">Y</span>,<span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Income elasticity for non-staples</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.n</span> <span class="op">&lt;-</span> <span class="va">tmp_param</span><span class="op">$</span><span class="va">yfunc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span>Y<span class="op">=</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">Y</span>,<span class="cn">FALSE</span><span class="op">)</span>

<span class="co">#Create data for the plot</span>
<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">eta.s</span>,color<span class="op">=</span><span class="st">"Income elasticities for staples"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">eta.n</span>,color<span class="op">=</span><span class="st">"Income elasticities for non-staples"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"GDP per capita in thousand USD"</span> <span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"elasticity value"</span><span class="op">)</span>

<span class="co">#Plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></code></pre></div>
<p><img src="example_5.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-1-5-calculate-price-elasticities" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-5-calculate-price-elasticities" class="anchor"></a>Example 1.5: Calculate price elasticities</h2>
<p>Similar to the income elasticities, the user can also calculate and analyze price elasticities. These elasticities. The function <code><a href="../reference/calc1eps.html">calc1eps()</a></code> can be used to recalculate price elasticities by passing the following parameters:</p>
<ol style="list-style-type: decimal">
<li><p>different budget shares (alphas)</p></li>
<li><p>income elasticities (calculated in example 1.5)</p></li>
<li><p>A matrix of values for elasticities (this is a part of the parameter structure set up in example 1.1)</p></li>
</ol>
<p>The price elasticities are calculated as an epsilion matrix with price elasticities for staples, non-staples and cross price elasticities.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#calc1eps returns a matrix of elasticities where the matrices are elasticities for staples(matrix 1), cross price #elasticities(matrix 2,3),non_staple elasticities(matrix 4))</span>

<span class="co">#Get staple price and income elasticities</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">staple_price_elasticity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc1eps.html">calc1eps</a></span><span class="op">(</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">alpha.s</span>, <span class="va">Food_Demand</span><span class="op">$</span><span class="va">alpha.n</span> , <span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.s</span> , <span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.n</span>, <span class="va">tmp_param</span><span class="op">$</span><span class="va">xi</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">300</span><span class="op">]</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.n</span> <span class="op">&lt;-</span> <span class="va">tmp_param</span><span class="op">$</span><span class="va">yfunc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span>Y<span class="op">=</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">Y</span>,<span class="cn">FALSE</span><span class="op">)</span>

<span class="co">#Get non-staple price and income elasticities</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">non_staple_price_elasticity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc1eps.html">calc1eps</a></span><span class="op">(</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">alpha.s</span>,<span class="va">Food_Demand</span><span class="op">$</span><span class="va">alpha.n</span>,<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.s</span>,<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.n</span>,<span class="va">tmp_param</span><span class="op">$</span><span class="va">xi</span><span class="op">)</span><span class="op">[</span><span class="fl">901</span><span class="op">:</span><span class="fl">1200</span><span class="op">]</span>
<span class="va">Food_Demand</span><span class="op">$</span><span class="va">eta.n</span> <span class="op">&lt;-</span> <span class="va">tmp_param</span><span class="op">$</span><span class="va">yfunc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span>Y<span class="op">=</span><span class="va">Food_Demand</span><span class="op">$</span><span class="va">Y</span>,<span class="cn">FALSE</span><span class="op">)</span>

<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">staple_price_elasticity</span>,color<span class="op">=</span><span class="st">"Staple price elasticity"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Food_Demand</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Y</span>,y<span class="op">=</span><span class="va">non_staple_price_elasticity</span>,color<span class="op">=</span><span class="st">"Non staple price elasticity"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"GDP per capita in thousand USD"</span> <span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"elasticity value"</span><span class="op">)</span>

<span class="co">#Plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></code></pre></div>
<p><img src="example_6.png" style="width:50.0%;height:50.0%"></p>
</div>
</div>
<div id="part-2-calculating-calibration-parameters-from-raw-data" class="section level1">
<h1 class="hasAnchor">
<a href="#part-2-calculating-calibration-parameters-from-raw-data" class="anchor"></a>Part 2: Calculating calibration parameters from raw data</h1>
<div id="example-2-1-get-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-1-get-parameters" class="anchor"></a>Example 2.1: Get parameters</h2>
<p>As mentioned in the documentation, <code>ambrosia</code> can generate estimates of food demand for staples and non-staples in thousand calories for given set of prices and income levels.</p>
<p>In addition to the price and income parameters, <code>ambrosia</code> requires 11 additional calibration parameters for the model. These parameters can be set using the function <code><a href="../reference/vec2param.html">vec2param()</a></code>. In order to understand the 11 parameters, their units, ranges and how they can be calculated, the user can call,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="fu"><a href="../reference/vec2param.html">vec2param</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The user can set the parameters by passing a 11 parameter vector directly to <code><a href="../reference/vec2param.html">vec2param()</a></code> or by setting the 11 parameters individually. The user can also directly call <code><a href="../reference/vec2param.html">vec2param()</a></code> to get the default parameter structure with default values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Use a sample vector of parameters. </span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.28</span>,<span class="fl">1.14</span>,<span class="op">-</span><span class="fl">0.19</span>,<span class="fl">0.21</span>,<span class="op">-</span><span class="fl">0.33</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>,<span class="fl">16</span>,<span class="fl">5.06</span>,<span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">original_param_vector</span>

<span class="co">#These are the names of the parameters</span>
<span class="va">parameter_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A_s'</span>, <span class="st">'A_n'</span>, <span class="st">'xi_ss'</span>, <span class="st">'xi_cross'</span>, <span class="st">'xi_nn'</span>, <span class="st">'nu1_n'</span>,
                     <span class="st">'lambda_s'</span>, <span class="st">'k_s'</span>, <span class="st">'Pm'</span>, <span class="st">'psscl'</span>,<span class="st">'pnscl'</span><span class="op">)</span>

<span class="co">#Create a dataframe of parameters</span>
<span class="va">parameter_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">parameter_names</span>,<span class="va">original_param_vector</span><span class="op">)</span>

<span class="co">#Return a parameter structure</span>
<span class="va">tmp_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vec2param.html">vec2param</a></span><span class="op">(</span><span class="va">original_param_vector</span><span class="op">)</span>

<span class="co">#Return a table of parameters</span>
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">parameter_data</span> ,col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"parameter_name"</span>,<span class="st">"value"</span><span class="op">)</span>,format <span class="op">=</span> <span class="st">"pandoc"</span><span class="op">)</span></code></pre></div>
<p>This section now explains how a user can calculate model parameters from raw data. This way, <code>ambrosia</code> can be calibrated to custom data sets.</p>
</div>
<div id="example-2-2-get-a-dataset-for-parameter-fitting-from-a-sample-training-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-2-get-a-dataset-for-parameter-fitting-from-a-sample-training-dataset" class="anchor"></a>Example 2.2: Get a dataset for parameter fitting from a sample training dataset</h2>
<p>One of the benefits of using <code>ambrosia</code> is that a user can estimate their own parameters with a custom data set using the log-likelihood maximization approach. To enable this, <code>ambrosia</code> is equipped with a function <code><a href="../reference/create_dataset_for_parameter_fit.html">create_dataset_for_parameter_fit()</a></code> that will help a user generate a dataset that is appropriate for parameter estimation. Note: The user can re-create the training data used to calculate the parameters for GCAM using the <code>Process_Demand_Data.R</code> under the scripts folder.</p>
<p>There are a few steps that the function will perform on a sample dataset.</p>
<ol style="list-style-type: decimal">
<li><p>It will ensure that the user’s dataset contains all columns required for parameter estimation</p></li>
<li><p>It will filter out anomalies and outliers using parameterized cutoff values selected by the user. This step is necessary since data on food consumption and prices are often incomplete which may lead to unrealistically high or low values of consumption or prices in the dataset.</p></li>
<li><p>After this, the function will create clusters of observations from the dataset based on income levels, and prices of staples and non-staples. This step is necessary because this being economic data, the observational error can only be calculated within different clusters. The code will also check for a user specified minimum number of clusters(If there are anomalies within the dataset, the clustering can be incorrect leading in a small number of clusters). The clustering is implemented using the Divisive Analysis Clustering Algorithm (DIANA)</p></li>
<li><p>Once the clustering is completed, the code will calculate the observational error which is the variance in food demand for staples (<span class="math inline">\({\sigma^{2}}Q_{s}\)</span>) and non-staples <span class="math inline">\({\sigma^{2}}Q_{n}\)</span> .Note that the user can chose a lower limit on the observational error calculated. The default value of the lower limit is 0.01</p></li>
</ol>
<p>In addition to a data frame, the function will return a CSV file output called “Processed_Data_for_MC.csv” that is stored in the outputs folder that will be used for the parameter estimation. The example below illustrates how to use the function on a raw dataset.</p>
<p>The example below illustrates how to use the function on a sample dataset</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load the training data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"training_data"</span><span class="op">)</span> 

<span class="co">#Create a sample dataset</span>
<span class="va">training_data</span> <span class="op">%&gt;%</span> 
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">sample_data</span>

<span class="co">#Create a dataset for parameter fit</span>
<span class="va">temp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dataset_for_parameter_fit.html">create_dataset_for_parameter_fit</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sample_data</span>,min_clusters <span class="op">=</span> <span class="fl">20</span>,min_price_pd <span class="op">=</span> <span class="fl">20</span>,min_cal_fd <span class="op">=</span> <span class="fl">1700</span>,outdir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
</div>
<div id="example-2-3-analyze-distribution-of-observational-error-for-non-staples" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-3-analyze-distribution-of-observational-error-for-non-staples" class="anchor"></a>Example 2.3: Analyze distribution of observational error for non-staples</h2>
<p>The dataset returned by this function can now be used for parameter estimation. The user can also plot the observational errors for staples and non-staples to ensure there is a valid distribution and the data is not skewed.</p>
<p>The below plots show the observational error for pre-generated data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load example processed_data </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"processed_data_example"</span><span class="op">)</span>

<span class="co">#Create a plot using example loaded above or data generated in example 2.1</span>
<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">processed_data_example</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sig2Qn</span><span class="op">)</span>,bins <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Observational error within clusters for non-staples"</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of observational error for non-staples for selected sample dataset"</span><span class="op">)</span>

<span class="co">#Plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>   </code></pre></div>
<p><img src="example_7.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-2-4-analyze-distribution-of-observational-error-for-staples" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-4-analyze-distribution-of-observational-error-for-staples" class="anchor"></a>Example 2.4: Analyze distribution of observational error for staples</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load example processed_data </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"processed_data_example"</span><span class="op">)</span>

<span class="co">#Create a plot using example loaded above or data generated in example 2.1</span>
<span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">processed_data_example</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sig2Qs</span><span class="op">)</span>,bins <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Observational error within clusters for staples"</span><span class="op">)</span><span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of observational error for staples for selected sample dataset"</span><span class="op">)</span>

<span class="co">#Plot   </span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>   </code></pre></div>
<p><img src="example_8.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-2-5-calculate-actual-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-5-calculate-actual-parameters" class="anchor"></a>Example 2.5: Calculate actual parameters</h2>
<p>Finally, the user can complete the parameter estimation on the dataset returned by <code><a href="../reference/create_dataset_for_parameter_fit.html">create_dataset_for_parameter_fit()</a></code> with a call to the calculate_ambrosia_params() function. ambrosia builds on the Edmonds et al.(2017) approach by maximizing the log-likelihood score using the optim() function. Note that the user can also choose to use a different method (for example, the original MCMC) to maximize the log-likelihood function by first setting up the log likelihood function using the <code><a href="../reference/mc.setup.html">mc.setup()</a></code> function.</p>
<p>The following steps are involved in the parameter estimation function,</p>
<ol style="list-style-type: decimal">
<li><p>First a log-likelihood function is set up with the data returned by the function above. This function calculates a log likelihood score using a weighted least squares approach (where the population of the region is the weight)</p></li>
<li><p>Now, the value returned by this function will be maximized using <code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code>. The user can provide a seed of initial parameters to begin the optimization process (the lowest possible seed would be the lowest values of all 11 parameters). The default seed is set to the original parameters from Edmonds et al. The user can now specify the optimization method to be used. The default is set to the “BFGS” method, but the user can also run the optimization using methods such as “Neldor-Mead” etc.</p></li>
<li><p>The function will now return a vector of parameters that can be used to derive estimates of food demand (Similar to Example 1 above). The function also prints out the maximized value of the log-likelihood function, so that the user can verify the efficiency and effectiveness of the parameter estimation.</p></li>
</ol>
<div id="warning-calculating-parameters-takes-a-long-time-around-25-minutes" class="section level3">
<h3 class="hasAnchor">
<a href="#warning-calculating-parameters-takes-a-long-time-around-25-minutes" class="anchor"></a>Warning: Calculating parameters takes a long time (around 25 minutes)</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load sample data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"processed_data_example"</span><span class="op">)</span>

<span class="co">#write it to a temporary csv</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">processed_data_example</span>,<span class="st">"Processed_Data_for_MC.csv"</span><span class="op">)</span>

<span class="co">#calculate new parameters using this saved dataset</span>
<span class="va">new_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_ambrosia_params.html">calculate_ambrosia_params</a></span><span class="op">(</span>datadir<span class="op">=</span><span class="st">"Processed_Data_for_MC.csv"</span>,
                                            optim_method <span class="op">=</span> <span class="st">"BFGS"</span>,
                                            original_param_vector<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.28</span>,<span class="fl">1.14</span>,<span class="op">-</span><span class="fl">0.19</span>,<span class="fl">0.21</span>,<span class="op">-</span><span class="fl">0.33</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>,<span class="fl">16</span>,<span class="fl">5.06</span>,<span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span>,
                                            ,outdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="example-2-6-set-up-a-log-likelihood-function-based-on-observational-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-6-set-up-a-log-likelihood-function-based-on-observational-data" class="anchor"></a>Example 2.6: Set up a log likelihood function based on observational data</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#The log likelihood function set up below can be used to fit parameters either using the maximization function or any #other approach like a Markov Chain Monte Carlo</span>

<span class="co">#load sample data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"processed_data_example"</span><span class="op">)</span>

<span class="co">#write it to a temporary csv</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">processed_data_example</span>,<span class="st">"Processed_Data_for_MC.csv"</span><span class="op">)</span>

<span class="co">#Now, set up a log likelihood function using the saved data. Note that the trace_param parameter is used #to trace parameter values during a fitting process like a MCMC calculation. See Part 4 below for more #details.</span>
<span class="va">func_MC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc.setup.html">mc.setup</a></span><span class="op">(</span><span class="st">"Processed_Data_for_MC.csv"</span>, trace_param<span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-2-7-calculate-the-log-likelihood-score-based-on-the-parameters-vector-calculated-in-example-2-4-and-the-log-likelihood-function-calculated-in-example-2-5" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-7-calculate-the-log-likelihood-score-based-on-the-parameters-vector-calculated-in-example-2-4-and-the-log-likelihood-function-calculated-in-example-2-5" class="anchor"></a>Example 2.7: Calculate the log likelihood score based on the parameters (vector) calculated in Example 2.4 and the log likelihood function calculated in Example 2.5</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"new_parameters"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"New parameters not calculated as shown in example 2.4. Loading pre-saved parameters"</span><span class="op">)</span>

<span class="va">new_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.28</span>,<span class="fl">1.14</span>,<span class="op">-</span><span class="fl">0.19</span>,<span class="fl">0.21</span>,<span class="op">-</span><span class="fl">0.33</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>,<span class="fl">16</span>,<span class="fl">5.06</span>,<span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span>

<span class="op">}</span>

<span class="co">#calculate the likelihood score using the function calculated in example 2.5</span>
<span class="va">likelihood_score</span> <span class="op">&lt;-</span> <span class="fu">func_MC</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">new_parameters</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="part-3-running-the-interactive-version-of-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#part-3-running-the-interactive-version-of-the-model" class="anchor"></a>Part 3: Running the interactive version of the model</h1>
<p>The user can also launch an interactive version of ambrosia to visually understand how the parameters are used to calculate the outputs and also to test new parameter values. Note that using the interactive version requires the <code>shiny</code> library to be installed.</p>
<div id="example-3-1-run-the-interactive-version-of-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3-1-run-the-interactive-version-of-the-model" class="anchor"></a>Example 3.1: Run the interactive version of the model</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/runapp.html">runapp</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="part-4-exploring-data-from-a-parameter-fitting-process-mcmc-or-maximization-or-any-other-process" class="section level1">
<h1 class="hasAnchor">
<a href="#part-4-exploring-data-from-a-parameter-fitting-process-mcmc-or-maximization-or-any-other-process" class="anchor"></a>Part 4: Exploring data from a parameter fitting process (MCMC or maximization or any other process)</h1>
<p>Now if a user calculated new parameters (either using <code><a href="../reference/calculate_ambrosia_params.html">calculate_ambrosia_params()</a></code> or by setting up the log likelihood function using <code><a href="../reference/mc.setup.html">mc.setup()</a></code> and maximizing the log likelihood using another method), <code>ambrosia</code> also allows the user to explore the results of a parameter fit.</p>
<div id="example-4-1-generating-parameter-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-1-generating-parameter-data" class="anchor"></a>Example 4.1: Generating parameter data</h2>
<p>Parameter data can be generated in two ways,</p>
<ol style="list-style-type: decimal">
<li>If <code><a href="../reference/calculate_ambrosia_params.html">calculate_ambrosia_params()</a></code> is used to calculate parameter values, the user would have to set the <code>trace_param</code> to TRUE to generate the data (.dat) file</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">new_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_ambrosia_params.html">calculate_ambrosia_params</a></span><span class="op">(</span>datadir<span class="op">=</span><span class="st">"Processed_Data_for_MC.csv"</span>,
                                            optim_method <span class="op">=</span> <span class="st">"BFGS"</span>,
                                            original_param_vector<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.28</span>,<span class="fl">1.14</span>,<span class="op">-</span><span class="fl">0.19</span>,<span class="fl">0.21</span>,<span class="op">-</span><span class="fl">0.33</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>,<span class="fl">16</span>,<span class="fl">5.06</span>,<span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span>,
                                            ,outdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>,
                                            trace_param <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>If the log-likelihood function was set up using <code><a href="../reference/mc.setup.html">mc.setup()</a></code> directly and this was maximized using some other method, then the same <code>trace_param</code> parameter needs to be set to TRUE before the fitting process to ensure the .dat file is generated.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">likelihood_function</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc.setup.html">mc.setup</a></span><span class="op">(</span><span class="st">"Processed_Data_for_MC.csv"</span>, trace_param <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p>Using the above code, the user can generate a .dat file which will track parameter samples during the fitting process along with the likelihood value itself.</p>
<p>The user can now read in the file, assign parameter names and generate density plots for the same.</p>
</div>
<div id="example-4-2-read-in-mc-data-and-create-density-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-2-read-in-mc-data-and-create-density-plots" class="anchor"></a>Example 4.2: Read in mc.data and create density plots</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load example data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mc_data_example"</span><span class="op">)</span>

<span class="co">#write it to a temporary file as an example</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">mc_data_example</span>,<span class="st">"mc_data_example.dat"</span><span class="op">)</span>

<span class="co">#Read the table</span>
<span class="co">#nparam is set to 11 since we are using the 11 </span>
<span class="va">mc_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.mc.data.html">read.mc.data</a></span><span class="op">(</span><span class="st">"mc_data_example.dat"</span>,varnames <span class="op">=</span> <span class="fu"><a href="../reference/namemc.html">namemc</a></span><span class="op">(</span>nparam <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Create the density plot</span>
<span class="fu"><a href="../reference/mcparam.density.html">mcparam.density</a></span><span class="op">(</span><span class="va">mc_example</span><span class="op">)</span></code></pre></div>
<p><img src="example_9.png" style="width:50.0%;height:50.0%"></p>
</div>
<div id="example-4-3-re-create-maximum-probability-density" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-3-re-create-maximum-probability-density" class="anchor"></a>Example 4.3: Re-create maximum probability density</h2>
<p>The user can also extract the parameters that yield the highest log likehood score from amongst the samples.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Load example data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mc_data_example"</span><span class="op">)</span>

<span class="co">#write it to a temporary file as an example</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">mc_data_example</span>,<span class="st">"mc_data_example.dat"</span><span class="op">)</span>

<span class="co">#Read the table</span>
<span class="va">mc_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.mc.data.html">read.mc.data</a></span><span class="op">(</span><span class="st">"mc_data_example.dat"</span>,varnames <span class="op">=</span> <span class="fu"><a href="../reference/namemc.html">namemc</a></span><span class="op">(</span>nparam <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span>

<span class="co">#The function  below will return a vector of parameters which yield the highest log likelihood score</span>
<span class="fu"><a href="../reference/mcparam.ML.html">mcparam.ML</a></span><span class="op">(</span><span class="va">mc_example</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ml_parameters</span>

<span class="co">#Set up the log-likelihood function</span>
<span class="va">func_MC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc.setup.html">mc.setup</a></span><span class="op">(</span><span class="st">"Processed_Data_for_MC.csv"</span><span class="op">)</span>

<span class="co">#Now calculate the probability density.The value should be -962</span>
<span class="va">probability_density</span> <span class="op">&lt;-</span> <span class="fu">func_MC</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ml_parameters</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kanishka Narayan, Chris Vernon, Stephanie Waldhoff, James Edmonds, Ryna Cui.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
